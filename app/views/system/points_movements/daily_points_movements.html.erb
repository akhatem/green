<!-- <div class="col-lg-5" style="margin-left:140px;">
    <div class="row">
        <div class="col-md-5 main-btns">
            <%#= link_to "Clear Search", system_daily_points_movements_path, class: "btn btn-outline-success", type: "button" %>
        </div>
        <div class="col-md-3">
            <div class="row mb-1">
                <%#= form_for "", url: system_daily_points_movements_path, role: "search", method: :get do %>
                    <%#= text_field_tag :search, @search_term, placeholder: "Search by date", style: "text-align: center;" %>
                <%# end %>
            </div>
        </div>
    </div>
</div> -->

<div class="col-lg-5 main-btns">
    <%= link_to "View PDF", system_points_movements_path(format: :pdf, page: params[:page]), 
        class: "btn btn-outline-success", type: "button"  %>
</div>

<% @branches.each do |branch| %>
    <% @daily_points_movements = PointsMovement.where(branch_id: branch.id)
    .group("DATE(date_time)")
    .order("DATE(date_time) ASC")
    .pluck("DATE(date_time)", "SUM(earned)" , "SUM(redeemed)" , "SUM(total)" ) %>

    <button class="accordion" id="accordion-id"><%= branch.name %></button>
    <div class="panel">
        <table class="table mt-2">
            <thead>
                <tr>
                    <th scope="col">Date</th>
                    <th scope="col">Earned</th>
                    <th scope="col">Redeemed</th>
                    <th scope="col">Redeemed To Cash</th>
                    <th scope="col">Total Points</th>
                </tr>
            </thead>
            <tbody>
                <% @daily_points_movements.each do |dpm| %>
                    <tr>
                        <td>
                            <%= dpm[0].strftime("%A, %d %b %Y") %>
                        </td>
                        <td>
                            <%= dpm[1] %>
                        </td>
                        <td>
                            <%= dpm[2] %>
                        </td>
                        <td>
                            <%= dpm[2] * Setting.find_by(key: :points_to_cash).description.to_f %>
                        </td>
                        <td>
                            <%= dpm[3] %>
                        </td>
                    </tr>
                <% end %>
            </tbody>
        </table>
    </div>
<% end %>

<script>
    var acc = document.getElementsByClassName("accordion");

    for (var i = 0; i < acc.length; i++) {
    acc[i].addEventListener("click", function() {
        this.classList.toggle("ac");
        var panel = this.nextElementSibling;
        if (panel.style.maxHeight) {
        panel.style.maxHeight = null;
        } else {
        panel.style.maxHeight = panel.scrollHeight + "px";
        } 
    });
    }
</script>